___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Enhencer - Purchase",
  "categories": ["CONVERSIONS", "ANALYTICS", "SESSION_RECORDING"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "Enhencer - Purchase",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "This tag has to fire after the purchase completed successfully.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "products",
    "displayName": "List of transaction products",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "userID",
    "displayName": "Enhencer User ID",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const callInWindow = require('callInWindow');

const purchased = ()=>{
  let cons = callInWindow('enhencerCollector.purchased', {products: data.products});
    
  data.gtmOnSuccess();
};

const onSuccess = () => {
  purchased();
};

const onFailure = () => {
  data.gtmOnFailure();
};

let url = "https://cdn.enhencer.com/scripts/dataCollector.js?token=" + data.userID;

if (queryPermission('inject_script', url)) {
  injectScript(url, onSuccess, onFailure);

} else {
  log('Script load failed due to permissions mismatch.');
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "enhencerCollector.purchased"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "enhencerCollector"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.enhencer.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 6/1/2021, 4:12:34 PM


